name: Deploy Dashboard to GitHub Pages

on:
  push:
    branches: [ main ]

# This sets the necessary permissions for the GITHUB_TOKEN to write to the Pages branch
permissions:
  contents: write

jobs:
  build-and-test:
    name: ğŸ—ï¸ Build and Test
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check Project Structure
        run: |
          echo "Verifying project files..."
          find . -name "*.html" -o -name "*.css" -o -name "*.js" | head -10

  deploy:
    name: ğŸš€ Deploy to GitHub Pages
    runs-on: ubuntu-latest
    needs: build-and-test # This ensures deploy only runs if the build job succeeds
    # The 'if' condition ensures deployment only happens on the main branch
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¤ Deploy with GitHub Pages action
        # This is the correct and official action for deployment
        uses: peaceiris/actions-gh-pages@v4
        with:
          # The GITHUB_TOKEN is provided automatically by GitHub Actions
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # Since your files are in the root, publish the entire directory
          publish_dir: ./